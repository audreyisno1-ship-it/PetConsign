<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>PetConsign Pro - 寄賣報表專家</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f8fafc; overflow-x: hidden; width: 100vw; -webkit-tap-highlight-color: transparent; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .safe-top { padding-top: env(safe-area-inset-top); }
      .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
      .sticky-stats { 
        position: sticky; 
        top: 0; 
        z-index: 40; 
        background: rgba(248, 250, 252, 0.95);
        backdrop-filter: blur(8px);
        margin-top: -1px;
      }
      .modal-overlay {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(4px);
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?external=react",
        "recharts": "https://esm.sh/recharts@2.10.3?external=react,react-dom"
      }
    }
    </script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useMemo } from 'react';
      import { createRoot } from 'react-dom/client';
      import { Package, BarChart3, Search, RotateCcw, Plus, Minus, Box, FileSpreadsheet, Calendar, Building2, TrendingUp, Award, PlusCircle, X, AlertCircle } from 'lucide-react';
      import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';

      const INITIAL_PRODUCTS = [
        // 風乾零食 (25項)
        ...Array.from({ length: 25 }).map((_, i) => {
          const names = [
            '貓咪抗拒不了貓草餅乾', '無雞不可，經典雞胸肉乾', '我愛吃鴨鴨，鴨胸肉乾', '喀滋喀滋鴨氣管', '鴨鴨繞南瓜',
            '雞雞繞南瓜', '秋葵鴨肉肉', '秋葵雞肉肉', '小雞繞紅蘿蔔', '黃金薑黃雞肉餅',
            '黃金薑黃鴨肉餅', '紅藜麥鴨肉條', '紅藜麥雞肉條', '牛肉塊', '藍莓芝士雞肉餅',
            '蘋果雞肉餅', '迷迭香牛肉餅', '羅勒雞肉條', '百里香鴨肉', '經典牛筋片',
            '丁香魚小魚乾', '鬆餅雞肉肉-芝芝藍莓', '鬆餅雞肉肉-蔬菜', '鬆餅雞肉肉-鴨鴨芝芝藍莓', '雞肉鬆鬆'
          ];
          const retailPrices = [250, 250, 300, 210, 260, 250, 260, 250, 300, 250, 300, 250, 200, 300, 300, 300, 210, 200, 210, 300, 180, 250, 250, 250, 200];
          return { id: `ad-${i+1}`, category: '風乾零食', name: names[i], retailPrice: retailPrices[i], wholesalePrice: Math.round(retailPrices[i] * 0.6) };
        }),
        // 凍乾零食 (19項)
        ...Array.from({ length: 19 }).map((_, i) => {
          const names = [
            '嗷嗚原形脆，雞小方', '嗷嗚原形脆，雞大排', '嗷嗚原形脆，雞小胗', '嗷嗚原形脆，雞皇冠', '嗷嗚原形脆，雞細條',
            '嗷嗚原形脆，鴨細條', '嗷嗚原形脆，脆鴨酥', '嗷嗚原形脆，鴨小舌', '嗷嗚原形脆，牛小方', '嗷嗚原形脆，羊小方',
            '嗷嗚原形脆，鮭小方', '嗷嗚原形脆，鮭大排', '嗷嗚原形脆，丁小魚', '嗷嗚原形脆，小蝦蝦', '嗷嗚原形脆，活力羊菜方',
            '嗷嗚原形脆，強健牛菜方', '嗷嗚原形脆，腸胃雞菜方', '嗷嗚原形脆，元氣鴨菜方', '嗷嗚原形脆，蔬菜纖方'
          ];
          const retailPrices = [250, 250, 210, 210, 250, 280, 210, 250, 280, 280, 300, 300, 280, 280, 340, 340, 340, 340, 320];
          return { id: `fd-${i+1}`, category: '凍乾零食', name: names[i], retailPrice: retailPrices[i], wholesalePrice: Math.round(retailPrices[i] * 0.6) };
        }),
        // 用品 (133項 - 依照用戶清單更新)
        ...(() => {
          const baseNames = [
            '狗狗慢食墊-蜜桃粉', '狗狗慢食墊-石灰藍', '狗狗慢食墊-蜂蜜黃', '狗狗慢食墊-灰草綠', '貓薄荷魚玩具',
            '冰淇淋綿綿球-單顆', '冰淇淋綿綿球-4顆', '藏食玩具-書本', '藏食玩具-曲奇餅乾', '藏食玩具-洋芋片',
            '矽膠吸盤餐盤附勺子-小鴨黃', '矽膠吸盤餐盤附勺子-寶寶藍', '矽膠吸盤餐盤附勺子-蜜桃粉', '矽膠吸盤餐盤附勺子-煙灰綠', '矽膠吸盤餐盤-奶白',
            '牽繩-大狗狗-粉-140cm/2cm', '牽繩-大狗狗-藍', '牽繩-大狗狗-黑加侖', '牽繩-大狗狗-黑', '牽繩-大狗狗-紫', '牽繩-大狗狗-橘', '牽繩-大狗狗-綠',
            '短牽繩-大狗狗-粉', '短牽繩-大狗狗-藍', '短牽繩-大狗狗-紫', '短牽繩-大狗狗-黑',
            '牽繩-小狗狗-咖啡色-150cm/8mm', '牽繩-小狗狗-紫色', '牽繩-小狗狗-綠色',
            '防暴衝胸背-黑S', '防暴衝胸背-黑M', '防暴衝胸背-黑L', '防暴衝胸背-紫S', '防暴衝胸背-紫M', '防暴衝胸背-紫L', '防暴衝胸背-藍S', '防暴衝胸背-藍M', '防暴衝胸背-藍L',
            '花花逗貓棒',
            '零食保鮮罐-淺灰粉-S-200ml', '零食保鮮罐-淺灰粉-M-300ml', '零食保鮮罐-淺灰粉-L-600ml', '零食保鮮罐-芥末黃-S', '零食保鮮罐-芥末黃-M', '零食保鮮罐-芥末黃-L',
            '零食保鮮罐-嫩草綠-S', '零食保鮮罐-嫩草綠-M', '零食保鮮罐-嫩草綠-L', '零食保鮮罐-淡海藍-S', '零食保鮮罐-淡海藍-M', '零食保鮮罐-淡海藍-L',
            '錐形伊莉莎白圈-奶酪黄-S', '錐形伊莉莎白圈-奶酪黄-M', '錐形伊莉莎白圈-奶酪黄-L', '錐形伊莉莎白圈-奶酪黄-XL',
            '錐形伊莉莎白圈-抹茶綠-S', '錐形伊莉莎白圈-抹茶綠-M', '錐形伊莉莎白圈-抹茶綠-L', '錐形伊莉莎白圈-抹茶綠-XL',
            '花朵伊莉莎白圈-夢幻紫-S', '花朵伊莉莎白圈-夢幻紫-M', '花朵伊莉莎白圈-夢幻紫-L',
            '花朵伊莉莎白圈-南瓜橙-S', '花朵伊莉莎白圈-南瓜橙-M', '花朵伊莉莎白圈-南瓜橙-L',
            '花朵伊莉莎白圈-天空藍-S', '花朵伊莉莎白圈-天空藍-M', '花朵伊莉莎白圈-天空藍-L',
            '花朵伊莉莎白圈-嫩草綠-S', '花朵伊莉莎白圈-嫩草綠-M', '花朵伊莉莎白圈-嫩草綠-L',
            '自製大狗花朵圈-粉-M', '自製大狗花朵圈-粉-L', '自製大狗花朵圈-粉-XL', '自製大狗花朵圈-粉-XXL',
            '自製大狗花朵圈-藍-M', '自製大狗花朵圈-藍-L', '自製大狗花朵圈-藍-XL', '自製大狗花朵圈-藍-XXL',
            '自製大狗花朵圈-綠-M', '自製大狗花朵圈-綠-L', '自製大狗花朵圈-綠-XL', '自製大狗花朵圈-綠-XXL',
            '甜甜圈陶瓷寵物碗單層奶油白', '甜甜圈陶瓷寵物碗單層小鴨黃', '甜甜圈陶瓷寵物碗單層芋泥紫',
            '雙頭轉接牽繩-黑', '雙頭轉接牽繩-橘粉', '雙頭轉接牽繩-紫', '雙頭轉接牽繩-黑白',
            '撿便袋-6袋',
            '棉花糖撿便器-霓虹果醬粉紫', '棉花糖撿便器-抹茶椰林粉白', '棉花糖撿便器-焦糖海鹽藍白', '棉花糖撿便器-銀色', '棉花糖撿便器-黑粉',
            '超耐咬狗骨頭-紅色', '超耐咬狗骨頭-藍色', '超耐咬狗骨頭-綠色', '超耐咬狗骨頭-紫色', '超耐咬狗骨頭-黃色', '超耐咬狗骨頭-扣環',
            '花朵玩具', 'BITE ME 土撥鼠', 'BITE ME 浣熊', 'BITE ME 松鼠', 'BITE ME 老鼠', 'BITE ME 曲奇',
            'DINGDOG 捲餅', 'DINGDOG 壽司', 'DINGDOG 蔥', 'DINGDOG 薯條', 'DINGDOG 炸蝦', 'DINGDOG 大漢堡', 'DINGDOG 小漢堡',
            'DINGDOG 鮪魚罐頭', 'DINGDOG 草莓果醬', 'DINGDOG 橘子果醬',
            'OKTK 毛孩衣 粉綠 L', 'OKTK 毛孩衣 粉綠 XL', 'OKTK 毛孩衣 粉綠 2XL', 'OKTK 毛孩衣 粉綠 3XL', 'OKTK 毛孩衣 粉綠 5XL', 'OKTK 毛孩衣 粉綠 6XL',
            'OKTK 毛孩衣 黑白 L', 'OKTK 毛孩衣 黑白 XL', 'OKTK 毛孩衣 黑白 2XL', 'OKTK 毛孩衣 黑白 3XL', 'OKTK 毛孩衣 黑白 5XL', 'OKTK 毛孩衣 黑白 6XL',
            'OKTK 領巾', '韓國慢食盤 黃色', '韓國逗貓棒 替換頭１', '韓國逗貓棒 替換頭２'
          ];
          const retailPriceMap = {
            '狗狗慢食墊': 310, '貓薄荷魚': 150, '冰淇淋綿綿球-單顆': 350, '冰淇淋綿綿球-4顆': 1200, '藏食玩具': 450,
            '矽膠吸盤餐盤': 425, '牽繩-大狗狗': 720, '短牽繩': 620, '牽繩-小狗狗': 720, '防暴衝胸背': 1200, '花花逗貓棒': 250,
            '保鮮罐-S': 290, '保鮮罐-M': 390, '保鮮罐-L': 490, '伊莉莎白圈-S': 600, '伊莉莎白圈-M': 650, '伊莉莎白圈-L': 650, '伊莉莎白圈-XL': 720,
            '花朵圈-S': 680, '花朵圈-M': 680, '花朵圈-L': 680, '大狗花朵圈-M': 680, '大狗花朵圈-L': 820, '大狗花朵圈-XL': 960, '大狗花朵圈-XXL': 1200,
            '陶瓷寵物碗': 580, '雙頭轉接牽繩': 880, '撿便袋-6袋': 180, '棉花糖撿便器': 210, '狗骨頭': 200, '花朵玩具': 380,
            'BITE ME': 880, '松鼠': 380, '老鼠': 380, '曲奇': 420, 'DINGDOG': 680, '薯條': 580, '小漢堡': 580, '鮪魚罐頭': 580, '果醬': 580,
            'OKTK 毛孩衣': 1380, '領巾': 350, '韓國慢食盤': 450, '韓國逗貓棒': 250
          };
          return Array.from({ length: 133 }).map((_, i) => {
            const name = baseNames[i] || `用品-預留品項 ${i+1}`;
            let retail = 450;
            for (const key in retailPriceMap) { if (name.includes(key)) { retail = retailPriceMap[key]; break; } }
            return { id: `sup-${i+1}`, category: '用品', name, retailPrice: retail, wholesalePrice: Math.round(retail * 0.6) };
          });
        })()
      ];

      const CATEGORIES = ['風乾零食', '凍乾零食', '用品'];
      const CHART_COLORS = ['#6366f1', '#f59e0b', '#0ea5e9', '#a855f7'];

      const QuickStat = ({ label, value, color }) => (
        <div className="bg-white p-3 rounded-2xl border border-slate-200 text-center shadow-sm relative overflow-hidden flex flex-col justify-center">
          <p className="text-[9px] font-black text-slate-400 uppercase mb-0.5 leading-none">{label}</p>
          <p className={`text-[13px] font-black ${color} truncate`}>{value}</p>
          <div className="absolute top-0 left-0 w-1 h-full bg-current opacity-20" />
        </div>
      );

      const CompactProductCard = ({ item, onUpdate }) => {
        const remaining = Math.max(0, item.consignmentTotal - item.weeklySales);
        const catColor = item.category === '風乾零食' ? 'bg-amber-100 text-amber-700' : 
                         item.category === '凍乾零食' ? 'bg-sky-100 text-sky-700' : 'bg-purple-100 text-purple-700';
        return (
          <div className="bg-white rounded-3xl border border-slate-200 p-4 shadow-sm hover:border-indigo-100 transition-colors">
            <div className="flex justify-between items-start gap-2 mb-3">
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1">
                   <span className={`px-2 py-0.5 rounded-lg text-[8px] font-black uppercase ${catColor}`}>{item.category}</span>
                   <span className={`text-[10px] font-bold ${remaining === 0 ? 'text-rose-500' : 'text-emerald-600'}`}>剩餘: {remaining}</span>
                </div>
                <h4 className="text-xs font-bold text-slate-800 leading-tight truncate">{item.name}</h4>
              </div>
              <div className="text-right">
                <p className="text-xs font-black text-slate-900">${item.retailPrice}</p>
                <p className="text-[9px] font-bold text-slate-400">批 ${item.wholesalePrice}</p>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <div className="flex items-center justify-between bg-slate-50 rounded-xl px-2 py-1 border border-slate-100">
                 <div className="flex flex-col">
                   <span className="text-[8px] font-black text-slate-400 uppercase leading-none">寄賣總數</span>
                 </div>
                 <div className="flex items-center gap-1">
                   <button onClick={() => onUpdate(item.id, 'consignmentTotal', -1)} className="p-1 hover:text-indigo-600 active:scale-90"><Minus size={14}/></button>
                   <input type="number" className="w-8 text-center bg-transparent text-xs font-black focus:outline-none" value={item.consignmentTotal} onChange={(e) => onUpdate(item.id, 'consignmentTotal', 0, parseInt(e.target.value) || 0)} />
                   <button onClick={() => onUpdate(item.id, 'consignmentTotal', 1)} className="p-1 hover:text-indigo-600 active:scale-90"><Plus size={14}/></button>
                 </div>
              </div>
              <div className="flex items-center justify-between bg-indigo-50/50 rounded-xl px-2 py-1 border border-indigo-100">
                 <div className="flex flex-col">
                   <span className="text-[8px] font-black text-indigo-400 uppercase leading-none">每週銷量</span>
                 </div>
                 <div className="flex items-center gap-1">
                   <button onClick={() => onUpdate(item.id, 'weeklySales', -1)} className="p-1 text-indigo-600 active:scale-90"><Minus size={14}/></button>
                   <input type="number" className="w-8 text-center bg-transparent text-xs font-black text-indigo-600 focus:outline-none" value={item.weeklySales} onChange={(e) => onUpdate(item.id, 'weeklySales', 0, parseInt(e.target.value) || 0)} />
                   <button onClick={() => onUpdate(item.id, 'weeklySales', 1)} className="p-1 text-indigo-600 active:scale-90"><Plus size={14}/></button>
                 </div>
              </div>
            </div>
            {item.weeklySales > item.consignmentTotal && (
              <div className="mt-2 flex items-center gap-1 text-rose-500 bg-rose-50 p-1.5 rounded-lg">
                <AlertCircle size={10} />
                <span className="text-[9px] font-bold">銷量超過寄賣總數，請核對！</span>
              </div>
            )}
          </div>
        );
      };

      const NavBtn = ({ active, onClick, icon, label }) => (
        <button onClick={onClick} className={`flex flex-col items-center gap-1 transition-all ${active ? 'text-indigo-600 scale-110' : 'text-slate-300'}`}>
          {icon}
          <span className="text-[9px] font-black tracking-tighter">{label}</span>
        </button>
      );

      const App = () => {
        const [inventory, setInventory] = useState([]);
        const [searchQuery, setSearchQuery] = useState('');
        const [selectedCategory, setSelectedCategory] = useState('全部');
        const [activeTab, setActiveTab] = useState('inventory');
        const [reportInfo, setReportInfo] = useState({
          date: new Date().toISOString().split('T')[0],
          companyName: ''
        });

        // 版本更新至 v16
        useEffect(() => {
          const saved = localStorage.getItem('pet-consign-v16');
          if (saved) setInventory(JSON.parse(saved));
          else setInventory(INITIAL_PRODUCTS.map(p => ({ ...p, consignmentTotal: 0, weeklySales: 0 })));
          const savedInfo = localStorage.getItem('pet-consign-info-v16');
          if (savedInfo) setReportInfo(JSON.parse(savedInfo));
        }, []);

        useEffect(() => {
          if (inventory.length > 0) localStorage.setItem('pet-consign-v16', JSON.stringify(inventory));
        }, [inventory]);

        useEffect(() => {
          localStorage.setItem('pet-consign-info-v16', JSON.stringify(reportInfo));
        }, [reportInfo]);

        const updateItem = (id, field, delta, directValue) => {
          setInventory(prev => prev.map(item => {
            if (item.id === id) {
              const newValue = directValue !== undefined ? Math.max(0, directValue) : Math.max(0, (item[field] || 0) + delta);
              return { ...item, [field]: newValue };
            }
            return item;
          }));
        };

        const stats = useMemo(() => {
          return inventory.reduce((acc, item) => {
            const revenue = item.weeklySales * item.retailPrice;
            const wholesaleRevenue = item.weeklySales * item.wholesalePrice;
            const profit = revenue - wholesaleRevenue;
            const remaining = Math.max(0, item.consignmentTotal - item.weeklySales);
            const stockValue = remaining * item.wholesalePrice;
            return {
              totalRevenue: acc.totalRevenue + revenue,
              totalWholesaleRevenue: acc.totalWholesaleRevenue + wholesaleRevenue,
              totalProfit: acc.totalProfit + profit,
              totalStockValue: acc.totalStockValue + stockValue
            };
          }, { totalRevenue: 0, totalWholesaleRevenue: 0, totalProfit: 0, totalStockValue: 0 });
        }, [inventory]);

        const analyticsData = useMemo(() => {
          return CATEGORIES.map(cat => {
            const catItems = inventory.filter(i => i.category === cat);
            const revenue = catItems.reduce((s, i) => s + (i.weeklySales * i.retailPrice), 0);
            const soldCount = catItems.reduce((s, i) => s + i.weeklySales, 0);
            const topItems = [...catItems].filter(i => i.weeklySales > 0).sort((a, b) => b.weeklySales - a.weeklySales).slice(0, 5);
            return { name: cat, revenue, soldCount, topItems };
          });
        }, [inventory]);

        const filteredInventory = useMemo(() => {
          return inventory.filter(item => {
            const matchesSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
            const matchesCategory = selectedCategory === '全部' || item.category === selectedCategory;
            return matchesSearch && matchesCategory;
          });
        }, [inventory, searchQuery, selectedCategory]);

        const handleReset = () => {
          if (window.confirm('執行週結算？\n「剩餘庫存」將自動轉為下週的「寄賣總數」，並歸零銷量。')) {
            setInventory(prev => prev.map(item => ({
              ...item,
              consignmentTotal: Math.max(0, item.consignmentTotal - item.weeklySales),
              weeklySales: 0
            })));
          }
        };

        const exportToExcel = () => {
          if (!reportInfo.companyName) return alert('請先填寫公司名稱！');
          let csv = "\uFEFF報表日期," + reportInfo.date + ",公司名稱," + reportInfo.companyName + "\n\n";
          CATEGORIES.forEach(cat => {
            csv += cat + "庫存明細\n分類,品名,零售價,批價(60%),寄賣數,週銷量,剩餘庫存,應付廠商小計(銷量*批價)\n";
            let subWholesale = 0;
            inventory.filter(i => i.category === cat).forEach(item => {
              const rem = Math.max(0, item.consignmentTotal - item.weeklySales);
              const val = item.weeklySales * item.wholesalePrice;
              subWholesale += val;
              csv += `${item.category},${item.name},${item.retailPrice},${item.wholesalePrice},${item.consignmentTotal},${item.weeklySales},${rem},${val}\n`;
            });
            csv += `,,,,,,,分類小計,${subWholesale}\n\n`;
          });
          csv += `\n結算統計\n總零售額,${stats.totalRevenue},廠商應收總額,${stats.totalWholesaleRevenue},店家利潤預估,${stats.totalProfit},場內賸餘貨物總值,${stats.totalStockValue}\n`;
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = `${reportInfo.companyName}_寄賣結算_${reportInfo.date}.csv`;
          link.click();
        };

        return (
          <div className="flex flex-col h-screen w-full bg-slate-50 overflow-hidden">
            <main className="flex-1 overflow-y-auto no-scrollbar scroll-smooth">
              <header className="bg-white px-5 pt-10 pb-6 border-b border-slate-200 safe-top">
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-xl font-black text-slate-900 flex items-center gap-2"><Package className="text-indigo-600" size={26} /> PetConsign <span className="text-indigo-600">Pro</span></h1>
                  <div className="flex gap-2">
                    <button onClick={exportToExcel} className="p-2.5 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center gap-1 active:scale-90 transition-all border border-emerald-100"><FileSpreadsheet size={18} /> <span className="text-xs font-bold uppercase">匯出 CSV</span></button>
                    <button onClick={handleReset} className="p-2.5 bg-indigo-50 text-indigo-600 rounded-2xl active:scale-90 transition-all border border-indigo-100 flex items-center gap-1"><RotateCcw size={18} /> <span className="text-xs font-bold uppercase">結算</span></button>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-4 mb-6">
                  <div className="flex flex-col gap-1">
                    <label className="text-[10px] font-black text-slate-400 uppercase ml-1">結算日期</label>
                    <div className="relative">
                      <Calendar className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-300" size={14} />
                      <input type="date" className="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-100 rounded-2xl text-xs font-bold text-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-100" value={reportInfo.date} onChange={(e)=>setReportInfo({...reportInfo, date: e.target.value})}/>
                    </div>
                  </div>
                  <div className="flex flex-col gap-1">
                    <label className="text-[10px] font-black text-slate-400 uppercase ml-1">寄賣點 / 公司</label>
                    <div className="relative">
                      <Building2 className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-300" size={14} />
                      <input type="text" placeholder="輸入寄賣單位名稱" className="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-100 rounded-2xl text-xs font-bold text-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-100" value={reportInfo.companyName} onChange={(e)=>setReportInfo({...reportInfo, companyName: e.target.value})}/>
                    </div>
                  </div>
                </div>
                {activeTab === 'inventory' && (
                  <div className="space-y-4">
                    <div className="relative">
                      <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300" size={18} />
                      <input type="text" placeholder="快速搜尋品項..." className="w-full pl-11 pr-4 py-3 bg-slate-100 border-none rounded-2xl text-sm font-medium focus:ring-2 focus:ring-indigo-500/10" value={searchQuery} onChange={(e)=>setSearchQuery(e.target.value)} />
                    </div>
                    <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                      {['全部', ...CATEGORIES].map(cat => (
                        <button key={cat} onClick={()=>setSelectedCategory(cat)} className={`px-5 py-2 rounded-2xl text-xs font-bold whitespace-nowrap transition-all ${selectedCategory === cat ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-100' : 'bg-white text-slate-500 border border-slate-200'}`}>{cat}</button>
                      ))}
                    </div>
                  </div>
                )}
              </header>
              {activeTab === 'inventory' && (
                <div className="sticky-stats px-4 py-3 border-b border-slate-200 shadow-sm">
                  <div className="grid grid-cols-3 gap-2">
                    <QuickStat label="總零售 (週)" value={`$${stats.totalRevenue.toLocaleString()}`} color="text-slate-600" />
                    <QuickStat label="總批價 (應付)" value={`$${stats.totalWholesaleRevenue.toLocaleString()}`} color="text-indigo-600" />
                    <QuickStat label="店家利潤" value={`$${stats.totalProfit.toLocaleString()}`} color="text-emerald-600" />
                  </div>
                </div>
              )}
              <div className="px-4 py-4 space-y-4">
                {activeTab === 'inventory' ? (
                  <div className="space-y-3 pb-24">
                    {filteredInventory.map(item => <CompactProductCard key={item.id} item={item} onUpdate={updateItem} />)}
                    {filteredInventory.length === 0 && (
                      <div className="text-center py-24 opacity-20">
                        <Box size={48} className="mx-auto text-slate-400" />
                        <p className="text-sm font-black mt-2">未找到符合條件的商品</p>
                      </div>
                    )}
                  </div>
                ) : (
                  <div className="space-y-6 pb-28">
                    <div className="bg-white p-6 rounded-[32px] shadow-sm border border-slate-100">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-sm font-black flex items-center gap-2 text-slate-800"><BarChart3 size={18} className="text-indigo-600" />各大項營收概況</h3>
                        <span className="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-1 rounded-lg font-black tracking-wider uppercase">零售營業額</span>
                      </div>
                      <div className="h-64 relative">
                        <ResponsiveContainer width="100%" height="100%">
                          <BarChart data={analyticsData} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>
                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fontSize: 11, fontWeight: 'bold', fill: '#94a3b8'}} />
                            <YAxis axisLine={false} tickLine={false} tick={{fontSize: 10, fontWeight: 'bold', fill: '#cbd5e1'}} />
                            <Tooltip cursor={{fill: 'rgba(99, 102, 241, 0.05)'}} contentStyle={{borderRadius: '16px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)', fontWeight: 'bold', fontSize: '12px'}} />
                            <Bar dataKey="revenue" radius={[8, 8, 0, 0]} barSize={40}>
                              {analyticsData.map((entry, index) => <Cell key={`cell-${index}`} fill={CHART_COLORS[index % CHART_COLORS.length]} />)}
                            </Bar>
                          </BarChart>
                        </ResponsiveContainer>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <h3 className="text-sm font-black px-2 flex items-center gap-2 text-slate-800 uppercase"><TrendingUp size={18} className="text-indigo-600" />Top 銷售排行 (件數)</h3>
                      {analyticsData.map((catData, idx) => (
                        <div key={catData.name} className="bg-white rounded-[32px] p-6 border border-slate-100 shadow-sm overflow-hidden relative">
                          <div className="flex justify-between items-end mb-6">
                             <div className="flex flex-col">
                               <div className="flex items-center gap-2 mb-1">
                                 <div className="w-3 h-3 rounded-full" style={{backgroundColor: CHART_COLORS[idx]}} />
                                 <span className="text-sm font-black text-slate-800 uppercase tracking-wide">{catData.name}</span>
                               </div>
                               <p className="text-[10px] font-bold text-slate-400">本週共銷售 {catData.soldCount} 件</p>
                             </div>
                             <div className="text-right">
                               <p className="text-[9px] font-black text-slate-300 uppercase leading-none">廠商應收小計</p>
                               <p className="text-sm font-black text-indigo-600">${catData.revenue.toLocaleString()}</p>
                             </div>
                          </div>
                          <div className="space-y-3">
                            {catData.topItems.length > 0 ? catData.topItems.map((item, i) => (
                              <div key={item.id} className="relative">
                                <div className="flex items-center justify-between mb-1.5 relative z-10">
                                   <div className="flex items-center gap-3 flex-1 min-w-0">
                                     <span className="text-[10px] font-black text-slate-300 w-4">{i+1}</span>
                                     <span className="text-[11px] font-bold text-slate-700 truncate">{item.name}</span>
                                   </div>
                                   <div className="text-right ml-3 shrink-0">
                                     <span className="text-[11px] font-black text-slate-800">{item.weeklySales} 份</span>
                                   </div>
                                </div>
                                <div className="h-1.5 w-full bg-slate-50 rounded-full overflow-hidden">
                                   <div className="h-full rounded-full transition-all duration-1000" style={{ width: `${catData.soldCount ? (item.weeklySales / catData.soldCount) * 100 : 0}%`, backgroundColor: CHART_COLORS[idx], opacity: 0.8 - (i * 0.15)}} />
                                </div>
                              </div>
                            )) : <div className="text-center py-6 text-[10px] text-slate-300 font-bold bg-slate-50 rounded-xl italic">本週暫無銷售記錄</div>}
                          </div>
                        </div>
                      ))}
                    </div>
                    <div className="bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-[32px] p-8 text-white shadow-xl shadow-indigo-100 relative overflow-hidden">
                      <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl" />
                      <div className="flex items-center gap-2 mb-6 relative z-10"><div className="p-2 bg-white/10 rounded-xl backdrop-blur-md"><Award size={22} className="text-white" /></div><h3 className="text-base font-black tracking-tight">結算總摘要</h3></div>
                      <div className="space-y-4 relative z-10">
                        <div className="flex justify-between items-center border-b border-white/10 pb-4">
                          <span className="text-xs font-bold text-white/60 uppercase">總廠商應收 (按 60% 批價)</span>
                          <span className="text-2xl font-black tabular-nums">${stats.totalWholesaleRevenue.toLocaleString()}</span>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-white/5 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-bold text-white/50 mb-1 uppercase tracking-wider">賸餘貨值 (批價計)</p>
                            <p className="text-xs font-black">${stats.totalStockValue.toLocaleString()}</p>
                          </div>
                          <div className="bg-white/5 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-bold text-white/50 mb-1 uppercase tracking-wider">預估總利潤</p>
                            <p className="text-xs font-black text-emerald-300">${stats.totalProfit.toLocaleString()}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </main>
            <nav className="bg-white border-t border-slate-200 safe-bottom px-10 py-4 flex justify-around items-center z-50 shadow-[0_-10px_30px_rgba(0,0,0,0.03)]">
              <NavBtn active={activeTab === 'inventory'} onClick={()=>setActiveTab('inventory')} icon={<Package size={24} strokeWidth={activeTab === 'inventory' ? 2.5 : 2} />} label="清單結算" />
              <NavBtn active={activeTab === 'analytics'} onClick={()=>setActiveTab('analytics')} icon={<BarChart3 size={24} strokeWidth={activeTab === 'analytics' ? 2.5 : 2} />} label="數據概覽" />
            </nav>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>